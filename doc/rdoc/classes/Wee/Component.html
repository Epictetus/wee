<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Wee::Component</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Wee::Component</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/wee/core/component_rb.html">
                lib/wee/core/component.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Presenter.html">
                Wee::Presenter
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The base class of all components. You should at least overwrite method <a
href="Component.html#M000158">render_content_on</a> in your own subclasses.
</p>

    </div>


    <div id="contents-list">
      <h3 class="section-bar">Contents</h3>
      <ul>
      <li><a href="#SEC00062">Render</a></li>
      <li><a href="#SEC00063">Callback</a></li>
      <li><a href="#SEC00064">Init</a></li>
      <li><a href="#SEC00065">Children</a></li>
      <li><a href="#SEC00066">Decoration</a></li>
      <li><a href="#SEC00067">Backtrack</a></li>
      <li><a href="#SEC00068">Call/Answer</a></li>
     </ul>
   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000163">add_child</a>&nbsp;&nbsp;
      <a href="#M000167">add_decoration</a>&nbsp;&nbsp;
      <a href="#M000173">answer</a>&nbsp;&nbsp;
      <a href="#M000171">backtrack_state</a>&nbsp;&nbsp;
      <a href="#M000170">backtrack_state_chain</a>&nbsp;&nbsp;
      <a href="#M000172">call</a>&nbsp;&nbsp;
      <a href="#M000162">children</a>&nbsp;&nbsp;
      <a href="#M000164">decoration</a>&nbsp;&nbsp;
      <a href="#M000165">decoration=</a>&nbsp;&nbsp;
      <a href="#M000166">each_decoration</a>&nbsp;&nbsp;
      <a href="#M000161">initialize</a>&nbsp;&nbsp;
      <a href="#M000159">process_callback_chain</a>&nbsp;&nbsp;
      <a href="#M000160">process_callbacks</a>&nbsp;&nbsp;
      <a href="#M000168">remove_decoration</a>&nbsp;&nbsp;
      <a href="#M000169">remove_decoration_if</a>&nbsp;&nbsp;
      <a href="#M000157">render_chain</a>&nbsp;&nbsp;
      <a href="#M000158">render_content_on</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="section">
      <h2 class="section-title"><a name="SEC00062">Render</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000157" class="method-detail">
        <a name="M000157"></a>

        <div class="method-heading">
          <a href="#M000157" class="method-signature">
          <span class="method-name">render_chain</span><span class="method-args">(rendering_context)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts rendering the decoration chain by calling method <a
href="Presenter.html#M000176">Presenter#render</a> for the first decoration
of the component, or calling <em>render</em> for the component itself if no
decorations were specified.
</p>
<dl>
<dt><tt>rendering_context</tt></dt><dd>An object of class <a href="RenderingContext.html">RenderingContext</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000157-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000157-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 19</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render_chain</span>(<span class="ruby-identifier">rendering_context</span>)
    <span class="ruby-identifier">decoration</span>.<span class="ruby-identifier">render</span>(<span class="ruby-identifier">rendering_context</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000158" class="method-detail">
        <a name="M000158"></a>

        <div class="method-heading">
          <a href="#M000158" class="method-signature">
          <span class="method-name">render_content_on</span><span class="method-args">(renderer)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method renders the content of this component with the given renderer.
</p>
<p>
<b>OVERWRITE</b> this method in your own component class to implement the
view. By default this method does nothing!
</p>
<dl>
<dt><tt>renderer</tt></dt><dd>A renderer object.

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000158-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000158-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 31</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render_content_on</span>(<span class="ruby-identifier">renderer</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00063">Callback</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000159" class="method-detail">
        <a name="M000159"></a>

        <div class="method-heading">
          <a href="#M000159" class="method-signature">
          <span class="method-name">process_callback_chain</span><span class="method-args">(callback_stream)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts processing the callbacks for the decoration chain by invoking method
<a href="Component.html#M000160">process_callbacks</a> of the first
decoration or the component itself if no decorations were specified.
</p>
<dl>
<dt><tt>callback_stream</tt></dt><dd>An object of class <a href="CallbackStream.html">CallbackStream</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000159-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000159-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 47</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_callback_chain</span>(<span class="ruby-identifier">callback_stream</span>)
    <span class="ruby-identifier">decoration</span>.<span class="ruby-identifier">process_callbacks</span>(<span class="ruby-identifier">callback_stream</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000160" class="method-detail">
        <a name="M000160"></a>

        <div class="method-heading">
          <a href="#M000160" class="method-signature">
          <span class="method-name">process_callbacks</span><span class="method-args">(callback_stream)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Process and invoke all callbacks specified for this component and all of
it&#8217;s child components.
</p>
<p>
All input callbacks of this component and it&#8217;s child components are
processed/invoked before any of the action callbacks are processed/invoked.
</p>
<dl>
<dt><tt>callback_stream</tt></dt><dd>An object of class <a href="CallbackStream.html">CallbackStream</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000160-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000160-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 60</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_callbacks</span>(<span class="ruby-identifier">callback_stream</span>)
    <span class="ruby-keyword kw">super</span> <span class="ruby-keyword kw">do</span>
      <span class="ruby-comment cmt"># process callbacks of all children</span>
      <span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">child</span>.<span class="ruby-identifier">process_callback_chain</span>(<span class="ruby-identifier">callback_stream</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00064">Init</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000161" class="method-detail">
        <a name="M000161"></a>

        <div class="method-heading">
          <a href="#M000161" class="method-signature">
          <span class="method-name">initialize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initializes a newly created component.
</p>
<p>
Call this method from your own components&#8217; <em>initialize</em> method
using <tt>super</tt>, before setting up anything else!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000161-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000161-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 80</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>() <span class="ruby-comment cmt"># :notnew:</span>
    <span class="ruby-ivar">@decoration</span> = <span class="ruby-constant">Wee</span><span class="ruby-operator">::</span><span class="ruby-constant">ValueHolder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
    <span class="ruby-ivar">@children</span> = []
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00065">Children</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000163" class="method-detail">
        <a name="M000163"></a>

        <div class="method-heading">
          <a href="#M000163" class="method-signature">
          <span class="method-name">add_child</span><span class="method-args">(child)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a child to the component. Example:
</p>
<pre>
  class YourComponent &lt; Wee::Component
    def initialize
      super()
      add_child ChildComponent.new
    end
  end
</pre>
<p>
If you dynamically add child components to a component at run-time (not in
initialize), then you should consider to backtrack the children array (of
course only if you want backtracking at all):
</p>
<pre>
  def backtrack_state(snapshot)
    super
    snapshot.add(self.children)
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000163-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000163-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 116</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_child</span>(<span class="ruby-identifier">child</span>)
    <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000162" class="method-detail">
        <a name="M000162"></a>

        <div class="method-heading">
          <a href="#M000162" class="method-signature">
          <span class="method-name">children</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all direct child components collected in an array.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000162-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000162-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 93</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children</span>
    <span class="ruby-ivar">@children</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00066">Decoration</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000167" class="method-detail">
        <a name="M000167"></a>

        <div class="method-heading">
          <a href="#M000167" class="method-signature">
          <span class="method-name">add_decoration</span><span class="method-args">(d)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds decoration <tt>d</tt> in front of the decoration chain.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000167-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000167-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 152</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_decoration</span>(<span class="ruby-identifier">d</span>)
    <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>
    <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span> = <span class="ruby-identifier">d</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000164" class="method-detail">
        <a name="M000164"></a>

        <div class="method-heading">
          <a href="#M000164" class="method-signature">
          <span class="method-name">decoration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the first decoration from the component&#8217;s decoration chain,
or <tt>self</tt> if no decorations were specified for the component.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000164-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000164-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 129</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decoration</span>
    <span class="ruby-ivar">@decoration</span>.<span class="ruby-identifier">value</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000165" class="method-detail">
        <a name="M000165"></a>

        <div class="method-heading">
          <a href="#M000165" class="method-signature">
          <span class="method-name">decoration=</span><span class="method-args">(d)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set the pointer to the first decoration to <tt>d</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000165-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000165-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 135</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decoration=</span>(<span class="ruby-identifier">d</span>) 
    <span class="ruby-ivar">@decoration</span>.<span class="ruby-identifier">value</span> = <span class="ruby-identifier">d</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000166" class="method-detail">
        <a name="M000166"></a>

        <div class="method-heading">
          <a href="#M000166" class="method-signature">
          <span class="method-name">each_decoration</span><span class="method-args">( {|decoration| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Iterates over all decorations (note that the component itself is excluded).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000166-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000166-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 141</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_decoration</span> <span class="ruby-comment cmt"># :yields: decoration</span>
    <span class="ruby-identifier">d</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>
    <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
      <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">d</span>
      <span class="ruby-identifier">d</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000168" class="method-detail">
        <a name="M000168"></a>

        <div class="method-heading">
          <a href="#M000168" class="method-signature">
          <span class="method-name">remove_decoration</span><span class="method-args">(d)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove decoration <tt>d</tt> from the decoration chain.
</p>
<p>
Returns the removed decoration or <tt>nil</tt> if it did not exist in the
decoration chain.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000168-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000168-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 162</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">d</span>)
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>  <span class="ruby-comment cmt"># 'd' is in front</span>
      <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-identifier">last_decoration</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>
      <span class="ruby-identifier">next_decoration</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_decoration</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">last_decoration</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">next_decoration</span> = <span class="ruby-identifier">last_decoration</span>.<span class="ruby-identifier">owner</span>
        <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">next_decoration</span>
        <span class="ruby-identifier">last_decoration</span> = <span class="ruby-identifier">next_decoration</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">last_decoration</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span>  
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-keyword kw">nil</span>  <span class="ruby-comment cmt"># decoration 'd' no longer is an owner of anything!</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">d</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000169" class="method-detail">
        <a name="M000169"></a>

        <div class="method-heading">
          <a href="#M000169" class="method-signature">
          <span class="method-name">remove_decoration_if</span><span class="method-args">( {|decoration| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove all decorations that match the block condition.
</p>
<p>
Example (removes all decorations of class <tt>HaloDecoration</tt>):
</p>
<pre>
  remove_decoration_if {|d| d.class == HaloDecoration}
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000169-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000169-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 187</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_decoration_if</span> <span class="ruby-comment cmt"># :yields: decoration</span>
    <span class="ruby-identifier">to_remove</span> = []
    <span class="ruby-identifier">each_decoration</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">to_remove</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">d</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">d</span>}
    <span class="ruby-identifier">to_remove</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">d</span>)}
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00067">Backtrack</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000171" class="method-detail">
        <a name="M000171"></a>

        <div class="method-heading">
          <a href="#M000171" class="method-signature">
          <span class="method-name">backtrack_state</span><span class="method-args">(snapshot)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Take snapshots of objects that should correctly be backtracked.
</p>
<p>
Backtracking means that you can go back in time of the components&#8217;
state. Therefore it is neccessary to take snapshots of those objects that
want to participate in backtracking. Taking snapshots of the whole
component tree would be too expensive and unflexible. Note that methods
<em>take_snapshot</em> and <em>restore_snapshot</em> are called for those
objects to take the snapshot (they behave like <em>marshal_dump</em> and
<em>marshal_load</em>). Overwrite them if you want to define special
behaviour.
</p>
<p>
By default only <tt>@decoration</tt> is backtracked (which actually is a <a
href="ValueHolder.html">ValueHolder</a>, as only the pointer changes not
the decoration-object itself!).
</p>
<p>
For example if you dynamically add children to your component, you might
want to backtrack the children array. Therefore you simply pass it to the
<a href="Snapshot.html#M000067">Snapshot#add</a> method:
</p>
<pre>
  def backtrack_state(snapshot)
    super
    snapshot.add(self.children)
  end
</pre>
<p>
This will call <a href="../Array.html#M000003">Array#take_snapshot</a> to
take the snapshot for the children array. If at a later point in time a
snapshot is restored, <a
href="../Array.html#M000004">Array#restore_snapshot</a> will be called with
the return value of <a href="../Array.html#M000003">Array#take_snapshot</a>
as argument.
</p>
<dl>
<dt><tt>snapshot</tt></dt><dd>An object of class <a href="Snapshot.html">Snapshot</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000171-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000171-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 244</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">backtrack_state</span>(<span class="ruby-identifier">snapshot</span>)
    <span class="ruby-identifier">snapshot</span>.<span class="ruby-identifier">add</span>(<span class="ruby-ivar">@decoration</span>)
    <span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">backtrack_state_chain</span>(<span class="ruby-identifier">snapshot</span>) <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000170" class="method-detail">
        <a name="M000170"></a>

        <div class="method-heading">
          <a href="#M000170" class="method-signature">
          <span class="method-name">backtrack_state_chain</span><span class="method-args">(snapshot)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts the backtrack-state phase for the decoration chain, by invoking
method <a href="Component.html#M000171">backtrack_state</a> of the first
decoration or the component itself if no decorations were specified.
</p>
<p>
See <a href="Component.html#M000171">backtrack_state</a> for details.
</p>
<dl>
<dt><tt>snapshot</tt></dt><dd>An object of class <a href="Snapshot.html">Snapshot</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000170-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000170-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 208</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">backtrack_state_chain</span>(<span class="ruby-identifier">snapshot</span>)
    <span class="ruby-identifier">decoration</span>.<span class="ruby-identifier">backtrack_state</span>(<span class="ruby-identifier">snapshot</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00068">Call/Answer</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000173" class="method-detail">
        <a name="M000173"></a>

        <div class="method-heading">
          <a href="#M000173" class="method-signature">
          <span class="method-name">answer</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return from a called component.
</p>
<p>
NOTE that <a href="Component.html#M000173">answer</a> never returns.
</p>
<p>
See <a href="Component.html#M000172">call</a> for a detailed description of
the call/answer mechanism.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000173-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000173-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 311</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">answer</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
    <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:wee_answer</span>, <span class="ruby-identifier">args</span> 
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000172" class="method-detail">
        <a name="M000172"></a>

        <div class="method-heading">
          <a href="#M000172" class="method-signature">
          <span class="method-name">call</span><span class="method-args">(component, return_callback=:use_continuation)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Call another component. The calling component is neither rendered nor are
it&#8217;s callbacks processed until the called component answers using
method <a href="Component.html#M000173">answer</a>.
</p>
<dl>
<dt><tt>component</tt></dt><dd>The component to be called.

</dd>
</dl>
<p>
<b>How it works</b>
</p>
<p>
At first a continuation is created. The component to be called is then
wrapped with an <a href="AnswerDecoration.html">AnswerDecoration</a> and
the continuation is assigned to it&#8217;s <tt>on_answer</tt> attribute.
Then a <a href="Delegate.html">Delegate</a> decoration is added to the
calling component (self), which delegates to the component to be called
(<tt>component</tt>). Then we unwind the calling stack back to the <a
href="Session.html">Session</a> by throwing <em>:wee_back_to_session</em>.
This means, that there is only ever one action callback invoked per
request. When at a later point in time the called component invokes <a
href="Component.html#M000173">answer</a>, this will throw a
<em>:wee_answer</em> exception which is catched in the <a
href="AnswerDecoration.html">AnswerDecoration</a>. The <a
href="AnswerDecoration.html">AnswerDecoration</a> then jumps back to the
continuation we created at the beginning, and finally method <a
href="Component.html#M000172">call</a> returns.
</p>
<p>
Note that <a href="Component.html#M000172">call</a> returns to an
&quot;old&quot; stack-frame from a previous request. That is why we throw
<em>:wee_back_to_session</em> after invoking an action callback, and
that&#8217;s why only ever one is invoked. We could remove this limitation
without problems, but then there would be a difference between those action
callbacks that call other components and those that do not.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000172-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000172-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 282</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">component</span>, <span class="ruby-identifier">return_callback</span>=<span class="ruby-identifier">:use_continuation</span>)
    <span class="ruby-identifier">add_decoration</span>(<span class="ruby-identifier">delegate</span> = <span class="ruby-constant">Wee</span><span class="ruby-operator">::</span><span class="ruby-constant">Delegate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">component</span>))
    <span class="ruby-identifier">component</span>.<span class="ruby-identifier">add_decoration</span>(<span class="ruby-identifier">answer</span> = <span class="ruby-constant">Wee</span><span class="ruby-operator">::</span><span class="ruby-constant">AnswerDecoration</span>.<span class="ruby-identifier">new</span>)

    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">return_callback</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:use_continuation</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">callcc</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">cc</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">on_answer</span> = <span class="ruby-identifier">cc</span>
        <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:wee_back_to_session</span>
      }
      <span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">delegate</span>)
      <span class="ruby-identifier">component</span>.<span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">answer</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-comment cmt"># TODO: make this marshallable! </span>
      <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">on_answer</span> = <span class="ruby-identifier">proc</span> {<span class="ruby-operator">|</span><span class="ruby-operator">*</span><span class="ruby-identifier">args</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">delegate</span>)
        <span class="ruby-identifier">component</span>.<span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">answer</span>)
        <span class="ruby-identifier">return_callback</span>.<span class="ruby-identifier">call</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
      }
      <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:wee_back_to_session</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>