<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Wee::Component</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Wee::Component</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/wee/core/component_rb.html">
                lib/wee/core/component.rb
                </a>
        <br />
                <a href="../../files/lib/wee/continuation/core/component_rb.html">
                lib/wee/continuation/core/component.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Presenter.html">
                Wee::Presenter
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The base class of all components. You should at least overwrite method <a
href="Component.html#M000254">render</a> in your own subclasses.
</p>

    </div>


    <div id="contents-list">
      <h3 class="section-bar">Contents</h3>
      <ul>
      <li><a href="#SEC00072">Render</a></li>
      <li><a href="#SEC00073">Callback</a></li>
      <li><a href="#SEC00074">Init</a></li>
      <li><a href="#SEC00075">Children</a></li>
      <li><a href="#SEC00076">Decoration</a></li>
      <li><a href="#SEC00077">Backtrack</a></li>
      <li><a href="#SEC00078">Call/Answer</a></li>
      <li><a href="#SEC00121">Call/Answer</a></li>
     </ul>
   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000259">add_child</a>&nbsp;&nbsp;
      <a href="#M000263">add_decoration</a>&nbsp;&nbsp;
      <a href="#M000269">answer</a>&nbsp;&nbsp;
      <a href="#M000267">backtrack_state</a>&nbsp;&nbsp;
      <a href="#M000266">backtrack_state_chain</a>&nbsp;&nbsp;
      <a href="#M000268">call</a>&nbsp;&nbsp;
      <a href="#M000270">call</a>&nbsp;&nbsp;
      <a href="#M000258">children</a>&nbsp;&nbsp;
      <a href="#M000260">decoration</a>&nbsp;&nbsp;
      <a href="#M000261">decoration=</a>&nbsp;&nbsp;
      <a href="#M000253">do_render_chain</a>&nbsp;&nbsp;
      <a href="#M000262">each_decoration</a>&nbsp;&nbsp;
      <a href="#M000257">initialize</a>&nbsp;&nbsp;
      <a href="#M000256">process_callbacks</a>&nbsp;&nbsp;
      <a href="#M000255">process_callbacks_chain</a>&nbsp;&nbsp;
      <a href="#M000264">remove_decoration</a>&nbsp;&nbsp;
      <a href="#M000265">remove_decoration_if</a>&nbsp;&nbsp;
      <a href="#M000254">render</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="section">
      <h2 class="section-title"><a name="SEC00072">Render</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000253" class="method-detail">
        <a name="M000253"></a>

        <div class="method-heading">
          <a href="#M000253" class="method-signature">
          <span class="method-name">do_render_chain</span><span class="method-args">(rendering_context)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts rendering the decoration chain by calling method <a
href="Presenter.html#M000288">Presenter#do_render</a> for the first
decoration of the component, or calling <em>do_render</em> for the
component itself if no decorations were specified.
</p>
<dl>
<dt><tt>rendering_context</tt></dt><dd>An object of class <a href="RenderingContext.html">RenderingContext</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000253-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000253-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 19</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_render_chain</span>(<span class="ruby-identifier">rendering_context</span>)
    <span class="ruby-identifier">decoration</span>.<span class="ruby-identifier">do_render</span>(<span class="ruby-identifier">rendering_context</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000254" class="method-detail">
        <a name="M000254"></a>

        <div class="method-heading">
          <a href="#M000254" class="method-signature">
          <span class="method-name">render</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method renders the content of this component.
</p>
<p>
<b>OVERWRITE</b> this method in your own component class to implement the
view. By default this method does nothing!
</p>
<p>
Use the current renderer as returned by renderer or it&#8217;s short-cut r.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000254-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000254-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 30</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">render</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00073">Callback</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000256" class="method-detail">
        <a name="M000256"></a>

        <div class="method-heading">
          <a href="#M000256" class="method-signature">
          <span class="method-name">process_callbacks</span><span class="method-args">(callback_stream)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Process and invoke all callbacks specified for this component and all of
it&#8217;s child components.
</p>
<p>
All input callbacks of this component and it&#8217;s child components are
processed/invoked before any of the action callbacks are processed/invoked.
</p>
<dl>
<dt><tt>callback_stream</tt></dt><dd>An object of class <a href="CallbackStream.html">CallbackStream</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000256-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000256-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 59</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_callbacks</span>(<span class="ruby-identifier">callback_stream</span>)
    <span class="ruby-keyword kw">super</span> <span class="ruby-keyword kw">do</span>
      <span class="ruby-comment cmt"># process callbacks of all children</span>
      <span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">child</span>.<span class="ruby-identifier">process_callbacks_chain</span>(<span class="ruby-identifier">callback_stream</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000255" class="method-detail">
        <a name="M000255"></a>

        <div class="method-heading">
          <a href="#M000255" class="method-signature">
          <span class="method-name">process_callbacks_chain</span><span class="method-args">(callback_stream)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts processing the callbacks for the decoration chain by invoking method
<a href="Component.html#M000256">process_callbacks</a> of the first
decoration or the component itself if no decorations were specified.
</p>
<dl>
<dt><tt>callback_stream</tt></dt><dd>An object of class <a href="CallbackStream.html">CallbackStream</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000255-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000255-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 46</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">process_callbacks_chain</span>(<span class="ruby-identifier">callback_stream</span>)
    <span class="ruby-identifier">decoration</span>.<span class="ruby-identifier">process_callbacks</span>(<span class="ruby-identifier">callback_stream</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00074">Init</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000257" class="method-detail">
        <a name="M000257"></a>

        <div class="method-heading">
          <a href="#M000257" class="method-signature">
          <span class="method-name">initialize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initializes a newly created component.
</p>
<p>
Call this method from your own components&#8217; <em>initialize</em> method
using <tt>super</tt>, before setting up anything else!
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000257-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000257-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 79</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>() <span class="ruby-comment cmt"># :notnew:</span>
    <span class="ruby-ivar">@decoration</span> = <span class="ruby-constant">Wee</span><span class="ruby-operator">::</span><span class="ruby-constant">ValueHolder</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
    <span class="ruby-ivar">@children</span> = []
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00075">Children</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000259" class="method-detail">
        <a name="M000259"></a>

        <div class="method-heading">
          <a href="#M000259" class="method-signature">
          <span class="method-name">add_child</span><span class="method-args">(child)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a child to the component. Example:
</p>
<pre>
  class YourComponent &lt; Wee::Component
    def initialize
      super()
      add_child ChildComponent.new
    end
  end
</pre>
<p>
If you dynamically add child components to a component at run-time (not in
initialize), then you should consider to backtrack the children array (of
course only if you want backtracking at all):
</p>
<pre>
  def backtrack_state(snapshot)
    super
    snapshot.add(self.children)
  end
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000259-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000259-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 115</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_child</span>(<span class="ruby-identifier">child</span>)
    <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">children</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child</span>
    <span class="ruby-identifier">child</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000258" class="method-detail">
        <a name="M000258"></a>

        <div class="method-heading">
          <a href="#M000258" class="method-signature">
          <span class="method-name">children</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all direct child components collected in an array.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000258-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000258-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 92</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children</span>
    <span class="ruby-ivar">@children</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00076">Decoration</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000263" class="method-detail">
        <a name="M000263"></a>

        <div class="method-heading">
          <a href="#M000263" class="method-signature">
          <span class="method-name">add_decoration</span><span class="method-args">(d)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds decoration <tt>d</tt> to the decoration chain.
</p>
<p>
A global decoration is added in front of the decoration chain, a local
decoration is added in front of all other local decorations but after all
global decorations.
</p>
<p>
Returns: <tt>self</tt>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000263-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000263-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 158</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_decoration</span>(<span class="ruby-identifier">d</span>)
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">global?</span>
      <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>
      <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span> = <span class="ruby-identifier">d</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-identifier">last_global</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">each_decoration</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> 
        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">global?</span>
          <span class="ruby-identifier">last_global</span> = <span class="ruby-identifier">i</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-keyword kw">break</span>
        <span class="ruby-keyword kw">end</span>
      }
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_global</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-comment cmt"># no global decorations specified -&gt; add in front</span>
        <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>
        <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span> = <span class="ruby-identifier">d</span>
      <span class="ruby-keyword kw">else</span>
        <span class="ruby-comment cmt"># add after last_global</span>
        <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-identifier">last_global</span>.<span class="ruby-identifier">owner</span>
        <span class="ruby-identifier">last_global</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-identifier">d</span> 
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">self</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000260" class="method-detail">
        <a name="M000260"></a>

        <div class="method-heading">
          <a href="#M000260" class="method-signature">
          <span class="method-name">decoration</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the first decoration from the component&#8217;s decoration chain,
or <tt>self</tt> if no decorations were specified for the component.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000260-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000260-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 129</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decoration</span>
    <span class="ruby-ivar">@decoration</span>.<span class="ruby-identifier">value</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000261" class="method-detail">
        <a name="M000261"></a>

        <div class="method-heading">
          <a href="#M000261" class="method-signature">
          <span class="method-name">decoration=</span><span class="method-args">(d)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Set the pointer to the first decoration to <tt>d</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000261-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000261-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 135</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decoration=</span>(<span class="ruby-identifier">d</span>) 
    <span class="ruby-ivar">@decoration</span>.<span class="ruby-identifier">value</span> = <span class="ruby-identifier">d</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000262" class="method-detail">
        <a name="M000262"></a>

        <div class="method-heading">
          <a href="#M000262" class="method-signature">
          <span class="method-name">each_decoration</span><span class="method-args">( {|decoration| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Iterates over all decorations (note that the component itself is excluded).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000262-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000262-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 141</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">each_decoration</span> <span class="ruby-comment cmt"># :yields: decoration</span>
    <span class="ruby-identifier">d</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>
    <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
      <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">d</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">d</span>
      <span class="ruby-identifier">d</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000264" class="method-detail">
        <a name="M000264"></a>

        <div class="method-heading">
          <a href="#M000264" class="method-signature">
          <span class="method-name">remove_decoration</span><span class="method-args">(d)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove decoration <tt>d</tt> from the decoration chain.
</p>
<p>
Returns the removed decoration or <tt>nil</tt> if it did not exist in the
decoration chain.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000264-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000264-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 190</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">d</span>)
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>  <span class="ruby-comment cmt"># 'd' is in front</span>
      <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-identifier">last_decoration</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">decoration</span>
      <span class="ruby-identifier">next_decoration</span> = <span class="ruby-keyword kw">nil</span>
      <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
        <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_decoration</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">last_decoration</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">next_decoration</span> = <span class="ruby-identifier">last_decoration</span>.<span class="ruby-identifier">owner</span>
        <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">next_decoration</span>
        <span class="ruby-identifier">last_decoration</span> = <span class="ruby-identifier">next_decoration</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">last_decoration</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span>  
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">d</span>.<span class="ruby-identifier">owner</span> = <span class="ruby-keyword kw">nil</span>  <span class="ruby-comment cmt"># decoration 'd' no longer is an owner of anything!</span>
    <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">d</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000265" class="method-detail">
        <a name="M000265"></a>

        <div class="method-heading">
          <a href="#M000265" class="method-signature">
          <span class="method-name">remove_decoration_if</span><span class="method-args">( {|decoration| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove all decorations that match the block condition.
</p>
<p>
Example (removes all decorations of class <tt>HaloDecoration</tt>):
</p>
<pre>
  remove_decoration_if {|d| d.class == HaloDecoration}
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000265-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000265-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 215</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_decoration_if</span> <span class="ruby-comment cmt"># :yields: decoration</span>
    <span class="ruby-identifier">to_remove</span> = []
    <span class="ruby-identifier">each_decoration</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">to_remove</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">d</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">d</span>}
    <span class="ruby-identifier">to_remove</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">d</span><span class="ruby-operator">|</span> <span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">d</span>)}
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00077">Backtrack</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000267" class="method-detail">
        <a name="M000267"></a>

        <div class="method-heading">
          <a href="#M000267" class="method-signature">
          <span class="method-name">backtrack_state</span><span class="method-args">(snapshot)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Take snapshots of objects that should correctly be backtracked.
</p>
<p>
Backtracking means that you can go back in time of the components&#8217;
state. Therefore it is neccessary to take snapshots of those objects that
want to participate in backtracking. Taking snapshots of the whole
component tree would be too expensive and unflexible. Note that methods
<em>take_snapshot</em> and <em>restore_snapshot</em> are called for those
objects to take the snapshot (they behave like <em>marshal_dump</em> and
<em>marshal_load</em>). Overwrite them if you want to define special
behaviour.
</p>
<p>
By default only <tt>@decoration</tt> is backtracked (which actually is a <a
href="ValueHolder.html">ValueHolder</a>, as only the pointer changes not
the decoration-object itself!).
</p>
<p>
For example if you dynamically add children to your component, you might
want to backtrack the children array. Therefore you simply pass it to the
<a href="Snapshot.html#M000142">Snapshot#add</a> method:
</p>
<pre>
  def backtrack_state(snapshot)
    super
    snapshot.add(self.children)
  end
</pre>
<p>
This will call <a href="../Array.html#M000010">Array#take_snapshot</a> to
take the snapshot for the children array. If at a later point in time a
snapshot is restored, <a
href="../Array.html#M000011">Array#restore_snapshot</a> will be called with
the return value of <a href="../Array.html#M000010">Array#take_snapshot</a>
as argument.
</p>
<dl>
<dt><tt>snapshot</tt></dt><dd>An object of class <a href="Snapshot.html">Snapshot</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000267-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000267-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 272</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">backtrack_state</span>(<span class="ruby-identifier">snapshot</span>)
    <span class="ruby-identifier">snapshot</span>.<span class="ruby-identifier">add</span>(<span class="ruby-ivar">@decoration</span>)
    <span class="ruby-identifier">children</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">backtrack_state_chain</span>(<span class="ruby-identifier">snapshot</span>) <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000266" class="method-detail">
        <a name="M000266"></a>

        <div class="method-heading">
          <a href="#M000266" class="method-signature">
          <span class="method-name">backtrack_state_chain</span><span class="method-args">(snapshot)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts the backtrack-state phase for the decoration chain, by invoking
method <a href="Component.html#M000267">backtrack_state</a> of the first
decoration or the component itself if no decorations were specified.
</p>
<p>
See <a href="Component.html#M000267">backtrack_state</a> for details.
</p>
<dl>
<dt><tt>snapshot</tt></dt><dd>An object of class <a href="Snapshot.html">Snapshot</a>

</dd>
</dl>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000266-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000266-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 236</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">backtrack_state_chain</span>(<span class="ruby-identifier">snapshot</span>)
    <span class="ruby-identifier">decoration</span>.<span class="ruby-identifier">backtrack_state</span>(<span class="ruby-identifier">snapshot</span>)
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00078">Call/Answer</a></h2>
      <div class="section-comment">
        
      </div>      

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Class <a href="Component/OnAnswer.html" class="link">Wee::Component::OnAnswer</a><br />

    </div>




      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000269" class="method-detail">
        <a name="M000269"></a>

        <div class="method-heading">
          <a href="#M000269" class="method-signature">
          <span class="method-name">answer</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return from a called component.
</p>
<p>
NOTE that <a href="Component.html#M000269">answer</a> never returns.
</p>
<p>
See <a href="Component.html#M000268">call</a> for a detailed description of
the call/answer mechanism.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000269-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000269-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 350</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">answer</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
    <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:wee_answer</span>, <span class="ruby-identifier">args</span> 
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000268" class="method-detail">
        <a name="M000268"></a>

        <div class="method-heading">
          <a href="#M000268" class="method-signature">
          <span class="method-name">call</span><span class="method-args">(component, return_callback=nil, *args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Call another component. The calling component is neither rendered nor are
it&#8217;s callbacks processed until the called component answers using
method <a href="Component.html#M000269">answer</a>.
</p>
<dl>
<dt><tt>component</tt></dt><dd>The component to be called.

</dd>
<dt><tt>return_callback</tt></dt><dd>Is invoked when the called component answers. Either a symbol or any object
that responds to <a href="Component.html#M000268">call</a>. If it&#8217;s a
symbol, then the corresponding method of the current component will be
called.

</dd>
<dt><tt>args</tt></dt><dd>Arguments that are passed to the <tt>return_callback</tt> before the
&#8216;onanswer&#8217; arguments.

</dd>
</dl>
<p>
<b>How it works</b>
</p>
<p>
The component to be called is wrapped with an <a
href="AnswerDecoration.html">AnswerDecoration</a> and the
<tt>return_callback</tt> parameter is assigned to it&#8217;s
<tt>on_answer</tt> attribute (not directly as there are cleanup actions to
be taken before the <tt>return_callback</tt> can be invoked, hence we wrap
it in the <a href="Component/OnAnswer.html">OnAnswer</a> class). Then a <a
href="Delegate.html">Delegate</a> decoration is added to the calling
component (self), which delegates to the component to be called
(<tt>component</tt>).
</p>
<p>
Then we unwind the calling stack back to the <a
href="Session.html">Session</a> by throwing <em>:wee_back_to_session</em>.
This means, that there is only ever one action callback invoked per
request. This is not neccessary, we could simply omit this, but then
we&#8217;d break compatibility with the implementation using continuations.
</p>
<p>
When at a later point in time the called component invokes <a
href="Component.html#M000269">answer</a>, this will throw a
<em>:wee_answer</em> exception which is catched in the <a
href="AnswerDecoration.html">AnswerDecoration</a>. The <a
href="AnswerDecoration.html">AnswerDecoration</a> then invokes the
<tt>on_answer</tt> callback which cleans up the decorations we added during
<a href="Component.html#M000268">call</a>, and finally passes control to
the <tt>return_callback</tt>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000268-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000268-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/core/component.rb, line 321</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">component</span>, <span class="ruby-identifier">return_callback</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
    <span class="ruby-identifier">add_decoration</span>(<span class="ruby-identifier">delegate</span> = <span class="ruby-constant">Wee</span><span class="ruby-operator">::</span><span class="ruby-constant">Delegate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">component</span>))
    <span class="ruby-identifier">component</span>.<span class="ruby-identifier">add_decoration</span>(<span class="ruby-identifier">answer</span> = <span class="ruby-constant">Wee</span><span class="ruby-operator">::</span><span class="ruby-constant">AnswerDecoration</span>.<span class="ruby-identifier">new</span>)
    <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">on_answer</span> = <span class="ruby-constant">OnAnswer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">component</span>, <span class="ruby-identifier">delegate</span>, <span class="ruby-identifier">answer</span>, 
                                    <span class="ruby-identifier">return_callback</span>, <span class="ruby-identifier">args</span>)
    <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:wee_back_to_session</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>
    <div id="section">
      <h2 class="section-title"><a name="SEC00121">Call/Answer</a></h2>
      <div class="section-comment">
        
      </div>      





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000270" class="method-detail">
        <a name="M000270"></a>

        <div class="method-heading">
          <a href="#M000270" class="method-signature">
          <span class="method-name">call</span><span class="method-args">(component, return_callback=:use_continuation, *additional_args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Call another component. The calling component is neither rendered nor are
it&#8217;s callbacks processed until the called component answers using
method <a href="Component.html#M000269">answer</a>.
</p>
<dl>
<dt><tt>component</tt></dt><dd>The component to be called.

</dd>
</dl>
<p>
<b>How it works</b>
</p>
<p>
At first a continuation is created. The component to be called is then
wrapped with an <a href="AnswerDecoration.html">AnswerDecoration</a> and
the continuation is assigned to it&#8217;s <tt>on_answer</tt> attribute.
Then a <a href="Delegate.html">Delegate</a> decoration is added to the
calling component (self), which delegates to the component to be called
(<tt>component</tt>). Then we unwind the calling stack back to the <a
href="Session.html">Session</a> by throwing <em>:wee_back_to_session</em>.
This means, that there is only ever one action callback invoked per
request. When at a later point in time the called component invokes <a
href="Component.html#M000269">answer</a>, this will throw a
<em>:wee_answer</em> exception which is catched in the <a
href="AnswerDecoration.html">AnswerDecoration</a>. The <a
href="AnswerDecoration.html">AnswerDecoration</a> then jumps back to the
continuation we created at the beginning, and finally method <a
href="Component.html#M000268">call</a> returns.
</p>
<p>
Note that <a href="Component.html#M000268">call</a> returns to an
&quot;old&quot; stack-frame from a previous request. That is why we throw
<em>:wee_back_to_session</em> after invoking an action callback, and
that&#8217;s why only ever one is invoked. We could remove this limitation
without problems, but then there would be a difference between those action
callbacks that call other components and those that do not.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000270-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000270-source">
<pre>
<span class="ruby-comment cmt"># File lib/wee/continuation/core/component.rb, line 36</span>
  <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">call</span>(<span class="ruby-identifier">component</span>, <span class="ruby-identifier">return_callback</span>=<span class="ruby-identifier">:use_continuation</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">additional_args</span>)
    <span class="ruby-identifier">add_decoration</span>(<span class="ruby-identifier">delegate</span> = <span class="ruby-constant">Wee</span><span class="ruby-operator">::</span><span class="ruby-constant">Delegate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">component</span>))
    <span class="ruby-identifier">component</span>.<span class="ruby-identifier">add_decoration</span>(<span class="ruby-identifier">answer</span> = <span class="ruby-constant">Wee</span><span class="ruby-operator">::</span><span class="ruby-constant">AnswerDecoration</span>.<span class="ruby-identifier">new</span>)

    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">return_callback</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:use_continuation</span>
      <span class="ruby-identifier">result</span> = <span class="ruby-identifier">callcc</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">cc</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">on_answer</span> = <span class="ruby-identifier">cc</span>
        <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:wee_back_to_session</span>
      }
      <span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">delegate</span>)
      <span class="ruby-identifier">component</span>.<span class="ruby-identifier">remove_decoration</span>(<span class="ruby-identifier">answer</span>)
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">result</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-identifier">answer</span>.<span class="ruby-identifier">on_answer</span> = <span class="ruby-constant">OnAnswer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">component</span>, <span class="ruby-identifier">delegate</span>, <span class="ruby-identifier">answer</span>,
                                      <span class="ruby-identifier">return_callback</span>, <span class="ruby-identifier">additional_args</span>)
      <span class="ruby-identifier">throw</span> <span class="ruby-identifier">:wee_back_to_session</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>